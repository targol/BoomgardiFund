<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Vazirmatn', sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            background-color: #f5f5f5;
            min-height: 100vh;
        }
        .sidebar {
            width: 200px;
            background-color: #4A704A;
            color: white;
            padding: 20px 0;
            position: fixed;
            height: 100%;
            top: 0;
            left: 0;
        }
        .sidebar a {
            display: block;
            padding: 10px 20px;
            color: white;
            text-decoration: none;
            font-size: 16px;
        }
        .sidebar a:hover {
            background-color: #3D5C3D;
        }
        .content {
            margin-left: 220px;
            padding: 20px;
            flex-grow: 1;
            width: calc(100% - 220px);
        }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; }
        .summary { margin-top: 20px; font-weight: bold; color: #333; }
        .button { margin-top: 10px; padding: 5px 10px; }
        .pagination { margin-top: 10px; text-align: center; }
        .pagination a { margin: 0 5px; text-decoration: none; color: #4A704A; }
        .pagination a.active { font-weight: bold; }
    </style>
</head>
<body>
    <div class="sidebar">
        <a href="{{ url_for('user_home', member_name=member_name) }}">خانه</a>
        <a href="{{ url_for('user_details', member_name=member_name) }}">جزییات تراکنش</a>
        <a href="{{ url_for('logout') }}">خروج</a>
    </div>
    <div class="content">
        <h1>تراکنش‌های {{ member_name }}</h1>
        <div class="summary">
            <p>جمع کل سرمایه اولیه: {{ initial_total | format_number }} تومان</p>
            <p>جمع کل عضویت‌های ماهانه: {{ membership_total | format_number }} تومان</p>
            <p>جمع کل: {{ total | format_number }} تومان</p>
        </div>
        <table id="transactionsTable">
            <thead>
                <tr>
                    <th>شناسه</th>
                    <th>تاریخ واریز (شمسی)</th>
                    <th>مبلغ واریز (تومان)</th>
                    <th>نوع واریز</th>
                    <th>توضیح</th>
                    <th>کد رهگیری</th>
                </tr>
            </thead>
            <tbody>
                {% for trans in transactions %}
                    <tr>
                        <td>{{ trans[0] }}</td>
                        <td>{{ trans[1] | gregorian_to_shamsi }}</td>
                        <td>{{ trans[2] | format_number }}</td>
                        <td>{{ trans[3] }}</td>
                        <td>{{ trans[4] }}</td>
                        <td>{{ trans[5] }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
        <div class="pagination" id="pagination"></div>
        <script>
            function showPage(page) {
                var table = document.getElementById('transactionsTable');
                var rows = table.getElementsByTagName('tr');
                var totalRows = rows.length - 1; // بدون هدر
                var totalPages = Math.ceil(totalRows / 10);
                for (var i = 1; i < rows.length; i++) {
                    rows[i].style.display = "none";
                }
                var start = (page - 1) * 10 + 1;
                var end = Math.min(start + 9, totalRows);
                for (var i = start; i <= end; i++) {
                    rows[i].style.display = "";
                }
                updatePagination(page, totalPages);
            }

            function updatePagination(currentPage, totalPages) {
                var pagination = document.getElementById('pagination');
                pagination.innerHTML = '';
                for (var i = 1; i <= totalPages; i++) {
                    var a = document.createElement('a');
                    a.href = '#';
                    a.textContent = i;
                    if (i === currentPage) a.className = 'active';
                    a.onclick = function(num) { return function() { showPage(num); }; }(i);
                    pagination.appendChild(a);
                }
            }

            window.onload = function() {
                var rows = document.getElementById('transactionsTable').getElementsByTagName('tr');
                var totalPages = Math.ceil((rows.length - 1) / 10);
                showPage(1);
            };
        </script>
        <a href="{{ url_for('admin') }}" class="button">بازگشت به پنل ادمین</a>
        <a href="{{ url_for('members') }}" class="button">بازگشت به لیست اعضا</a>
    </div>
</body>
</html>
